<section class="pluv-edit" id="pluvEditPanel" aria-label="Editar pluviômetro">
  <div class="pluv-edit__crumbs">Pluviometria / <strong>Editar Pluviômetro</strong></div>

  <div class="pluv-edit__titlebar">
    <button class="pluv-edit__back" type="button" id="pluvEditBack" aria-label="Voltar">
      <i class="fa-solid fa-chevron-left"></i>
      <span>Editar Pluviômetro</span>
    </button>

    <div class="pluv-edit__actions">
      <div class="pluv-edit__select-wrap">
        <div class="pluv-edit__select-field" data-pluv-select>
          <button class="pluv-edit__select-btn" type="button" id="pluvEditSelectBtn" data-pluv-select-trigger
            aria-expanded="false" aria-label="Selecionar pluviômetro"></button>
          <i class="fa-solid fa-chevron-down"></i>
          <div class="pluv-edit__select-menu" role="listbox" id="pluvEditSelectMenu" data-pluv-menu="pluvio"></div>
        </div>
      </div>
      <button class="pluv-edit__save" type="button">
        <i class="fa-solid fa-floppy-disk"></i>
        Salvar
      </button>
    </div>
  </div>

  <div class="pluv-edit__tabs" role="tablist" aria-label="Seções">
    <button class="pluv-edit__tab is-active" type="button" data-tab="config" aria-selected="true">Configurações</button>
    <button class="pluv-edit__tab" type="button" data-tab="history" aria-selected="false">Histórico</button>
  </div>

  <div class="pluv-edit__tab-body is-active" data-tab-body="config">
    <div class="pluv-edit__body">
      <aside class="pluv-edit__nav" aria-label="Atalhos">
        <button class="pluv-edit__nav-item is-active" type="button" data-target="#pluvEditGeneral">Geral</button>
        <button class="pluv-edit__nav-item" type="button" data-target="#pluvEditLocation">Localização</button>
        <button class="pluv-edit__nav-item" type="button" data-target="#pluvEditAssociation">Associação</button>
        <button class="pluv-edit__nav-item" type="button" data-target="#pluvEditMaintenance">Manutenção</button>
        <button class="pluv-edit__nav-item" type="button" data-target="#pluvEditSensors">Sensores</button>
        <button class="pluv-edit__nav-item" type="button" data-target="#pluvEditRedundancy">Redundância</button>
        <button class="pluv-edit__nav-item" type="button" data-target="#pluvEditFirmware">Firmware (OTA)</button>
        <div class="pluv-edit__nav-dev">
          <div class="maint__dev">
            <div class="maint__dev-title">Dev Mode</div>
            <div class="maint__dev-text">Para simular confirmação física:</div>
            <code class="maint__dev-code">window.__devConfirmMaintenance()</code>
          </div>
        </div>
      </aside>

      <div class="pluv-edit__content">
        <section class="pluv-edit__section is-active" id="pluvEditGeneral">
          <div class="pluv-edit__section-head">
            <div class="pluv-edit__section-head-row">
              <h2>Geral</h2>
              <span class="pluv-edit__badge" id="pluvEditStatus">—</span>
            </div>
            <p id="pluvEditLastUpdate">Última comunicação: —</p>
          </div>
          <div class="pluv-edit__section-body pluv-edit__section-body--stack">
            <div class="pluv-edit__grid-3">
              <div class="pluv-edit__field-box">
                <label>Rádio da central</label>
                <input class="pluv-edit__input" id="pluvEditRadioCentral" type="text" value="" />
              </div>
              <div class="pluv-edit__field-box">
                <label>Rádio do controlador <span class="pluv-edit__req">*</span></label>
                <input class="pluv-edit__input" id="pluvEditRadioControl" type="text" value="" />
              </div>
              <div class="pluv-edit__field-box">
                <label>Rádio do GPS <span class="pluv-edit__req">*</span></label>
                <input class="pluv-edit__input" id="pluvEditRadioGps" type="text" value="" />
              </div>
            </div>

            <div class="pluv-edit__section-body--grid">
              <div class="pluv-edit__field">
                <label>Nome do pluviômetro</label>
                <input class="pluv-edit__input" id="pluvEditName" type="text" value="" />
              </div>
              <div class="pluv-edit__field">
                <label>Talhão</label>
                <input class="pluv-edit__input" id="pluvEditPlot" type="text" value="" />
              </div>
              <div class="pluv-edit__field">
                <label>Modelo</label>
                <input class="pluv-edit__input" id="pluvEditModel" type="text" value="" />
              </div>
              <div class="pluv-edit__field">
                <label>Rede</label>
                <input class="pluv-edit__input" id="pluvEditNetwork" type="text" value="" />
              </div>
              <div class="pluv-edit__field">
                <label>Tipo de pluviômetro</label>
                <div class="pluv-edit__select-field">
                  <button class="pluv-edit__select-btn" type="button" data-edit-select="type"
                    aria-expanded="false"></button>
                  <i class="fa-solid fa-chevron-down"></i>
                  <div class="pluv-edit__select-menu" role="listbox" data-edit-menu="type"></div>
                </div>
              </div>
              <div class="pluv-edit__field">
                <label>Alimentação</label>
                <div class="pluv-edit__select-field">
                  <button class="pluv-edit__select-btn" type="button" data-edit-select="power"
                    aria-expanded="false"></button>
                  <i class="fa-solid fa-chevron-down"></i>
                  <div class="pluv-edit__select-menu" role="listbox" data-edit-menu="power"></div>
                </div>
                <span class="pluv-edit__field-hint" id="pluvEditPowerState">Estado: —</span>
              </div>
              <div class="pluv-edit__field pluv-edit__field--span">
                <label>Uso na plataforma</label>
                <div class="pluv-edit__checks">
                  <label class="pluv-edit__check">
                    <input type="checkbox" id="pluvEditUseIrrigation" />
                    Irrigação
                  </label>
                  <label class="pluv-edit__check">
                    <input type="checkbox" id="pluvEditUseAlerts" />
                    Alertas
                  </label>
                  <label class="pluv-edit__check">
                    <input type="checkbox" id="pluvEditUseReports" />
                    Relatórios
                  </label>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section class="pluv-edit__section" id="pluvEditLocation">
          <div class="pluv-edit__section-title">Localização</div>
          <div class="pluv-edit__location">
            <div class="pluv-edit__location-left">
              <div class="pluv-edit__map" id="pluvEditMap" aria-label="Mapa de localização"></div>
            </div>

            <div class="pluv-edit__location-form">
              <div class="pluv-edit__location-block">
                <div class="pluv-edit__location-title">Localização</div>
                <p>A localização em campo do pluviômetro é essencial para mostrar geograficamente no mapa a posição do
                  equipamento.</p>
              </div>

              <div class="pluv-edit__field">
                <label>Centro</label>
                <div class="pluv-edit__location-row">
                  <input class="pluv-edit__input" id="pluvEditCenter" type="text" value="" readonly />
                  <button class="pluv-edit__btn" type="button" id="pluvEditCenterBtn">
                    <i class="fa-solid fa-location-dot"></i>
                    Obter localização
                  </button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <section class="pluv-edit__section" id="pluvEditAssociation">
          <div class="pluv-edit__section-title">Associação</div>
          <p class="pluv-edit__section-head-p" style="margin-bottom: 12px; font-size: 11px; color:#64748b;">
            Gerencie a associação entre pluviômetros e talhões. Selecione os pluviômetros na lista para visualizar e
            vincular.
          </p>

          <div class="pluv-assoc-layout">
            <aside class="pluv-assoc__sidebar pluv-assoc__sidebar--left">
              <div class="pluv-assoc__ctx">
                <div class="pluv-assoc__ctx-head">
                  <span class="pluv-assoc__ctx-title">Talhões</span>
                  <div style="display:flex; gap:6px; align-items:center;">
                    <button type="button" id="btnAutoAssoc" class="pluv-edit__btn"
                      style="padding:4px 8px; font-size:11px;" title="Associar Automaticamente">
                      <i class="fa-solid fa-wand-magic-sparkles"></i> Auto
                    </button>
                    <span class="pluv-assoc__ctx-badge" id="pluvTalhoesCount">0</span>
                  </div>
                </div>
              </div>
              <div class="pluv-assoc__list" id="pluvTalhoesList">
                <div class="pluv-assoc__empty">Carregando...</div>
              </div>
            </aside>

            <div class="pluv-assoc__map-wrapper">
              <div id="pluvAssocMap" class="pluv-assoc__map"></div>
            </div>

            <aside class="pluv-assoc__sidebar">
              <div class="pluv-assoc__ctx">
                <div class="pluv-assoc__ctx-head">
                  <span class="pluv-assoc__ctx-title">Pluviômetros</span>
                  <span class="pluv-assoc__ctx-badge" id="pluvAssocCount">0</span>
                </div>
                <div class="pluv-assoc__search">
                  <i class="fa-solid fa-magnifying-glass"></i>
                  <input type="text" placeholder="Buscar pluviômetro..." id="pluvAssocSearch">
                </div>
              </div>

              <div class="pluv-assoc__list" id="pluvAssocList">
                <!-- Mock Items for Visual -->
                <div class="pluv-assoc__item">
                  <div class="pluv-assoc__item-row">
                    <span class="pluv-assoc__item-name">Norte A</span>
                    <i class="fa-solid fa-chevron-right"></i>
                  </div>
                  <div class="pluv-assoc__item-meta">Sem associação</div>
                </div>
                <!-- List will be populated by JS later -->
              </div>
            </aside>
          </div>
        </section>

        <section class="pluv-edit__section" id="pluvEditMaintenance">
          <div class="pluv-edit__section-title">Manutenção</div>
          <div class="pluv-edit__section-body" data-section-body="maintenance"></div>

          <div class="pluv-edit__maintenance-history-card">
            <div class="pluv-edit__maintenance-history-head">
              <p>ðŸ“œ Histórico de manutenções</p>
              <button class="pluv-edit__history-cta" type="button">
                <span></span>
                <span>Ver histórico completo</span>
              </button>
            </div>

            <ul class="pluv-edit__maintenance-history-list">
              <li class="pluv-edit__maintenance-history-item">
                <div class="pluv-edit__history-top">
                  <span class="pluv-edit__history-date">08/01/2026</span>
                  <span class="pluv-pill pluv-pill--ok pluv-edit__history-pill pluv-edit__history-pill--ok">âœ…
                    Confirmado no dispositivo</span>
                </div>
                <div class="pluv-edit__history-meta">
                  <span>Tipo realizado: Verificação periódica</span>
                  <span>Responsável: João Silva</span>
                </div>
              </li>

              <li class="pluv-edit__maintenance-history-item">
                <div class="pluv-edit__history-top">
                  <span class="pluv-edit__history-date">26/12/2025</span>
                  <span class="pluv-pill pluv-pill--warn pluv-edit__history-pill pluv-edit__history-pill--warn">âš ï¸
                    Corretiva fora do ciclo</span>
                </div>
                <div class="pluv-edit__history-meta">
                  <span>Tipo realizado: Troca de sensor</span>
                  <span>Responsável: Mateus Freitas</span>
                </div>
              </li>

              <li class="pluv-edit__maintenance-history-item">
                <div class="pluv-edit__history-top">
                  <span class="pluv-edit__history-date">14/11/2025</span>
                  <span class="pluv-pill pluv-pill--ok pluv-edit__history-pill pluv-edit__history-pill--ok">âœ…
                    Confirmado no dispositivo</span>
                </div>
                <div class="pluv-edit__history-meta">
                  <span>Tipo realizado: Calibração de leitura</span>
                  <span>Responsável: Andreia Lima</span>
                </div>
              </li>
            </ul>
          </div>
        </section>

        <section class="pluv-edit__section" id="pluvEditSensors">
          <div class="pluv-edit__section-title">Sensores</div>
          <div class="pluv-edit__section-body" data-section-body="sensors"></div>
        </section>

        <section class="pluv-edit__section" id="pluvEditRedundancy">
          <div class="pluv-edit__section-title">Redundância</div>
          <div class="pluv-edit__section-body" data-section-body="redundancy"></div>
        </section>

        <section class="pluv-edit__section" id="pluvEditFirmware">
          <div class="pluv-edit__section-title">Firmware (OTA)</div>
          <div class="pluv-edit__section-body">
            <div class="pluv-fw">
              <div class="pluv-fw__header">
                <div class="pluv-fw__title">
                  <span class="pluv-fw__icon">
                    <i class="fa-solid fa-download"></i>
                  </span>
                  <div class="pluv-fw__title-text">
                    <span class="pluv-fw__name">Firmware (OTA)</span>
                    <span class="pluv-fw__sub">Atualização remota do pluviômetro</span>
                  </div>
                </div>
                <button class="pluv-fw__toggle" type="button" aria-label="Recolher">
                  <i class="fa-solid fa-chevron-up"></i>
                </button>
              </div>
              <div class="pluv-fw__body">
                <div class="pluv-fw__version-row">
                  <div class="pluv-fw__version">
                    <span class="pluv-fw__label">Versão atual</span>
                    <strong class="pluv-fw__value">2.4.1</strong>
                  </div>
                  <div class="pluv-fw__version pluv-fw__version--right">
                    <span class="pluv-fw__pill">Nova versão disponível</span>
                    <strong class="pluv-fw__value">2.5.0</strong>
                  </div>
                </div>
                <button class="pluv-fw__cta" type="button">
                  <i class="fa-solid fa-arrow-down-to-line"></i>
                  Atualizar para 2.5.0
                </button>
                <div class="pluv-fw__last">
                  <span class="pluv-fw__last-label">Última tentativa</span>
                  <div class="pluv-fw__last-row">
                    <span class="pluv-fw__badge">
                      <i class="fa-solid fa-circle-check"></i>
                      Sucesso
                    </span>
                    <span class="pluv-fw__date">07/02/2026</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

      </div>
    </div>
  </div>

  <div class="pluv-edit__tab-body" data-tab-body="history">
    <div class="pluv-edit__history">
      <div class="pluv-edit__empty">Histórico em construção.</div>
    </div>
  </div>
</section>